data = """             Z L X W       C
             Z P Q B       K
  ###########.#.#.#.#######.###############
  #...#.......#.#.......#.#.......#.#.#...#
  ###.#.#.#.#.#.#.#.###.#.#.#######.#.#.###
  #.#...#.#.#...#.#.#...#...#...#.#.......#
  #.###.#######.###.###.#.###.###.#.#######
  #...#.......#.#...#...#.............#...#
  #.#########.#######.#.#######.#######.###
  #...#.#    F       R I       Z    #.#.#.#
  #.###.#    D       E C       H    #.#.#.#
  #.#...#                           #...#.#
  #.###.#                           #.###.#
  #.#....OA                       WB..#.#..ZH
  #.###.#                           #.#.#.#
CJ......#                           #.....#
  #######                           #######
  #.#....CK                         #......IC
  #.###.#                           #.###.#
  #.....#                           #...#.#
  ###.###                           #.#.#.#
XF....#.#                         RF..#.#.#
  #####.#                           #######
  #......CJ                       NM..#...#
  ###.#.#                           #.###.#
RE....#.#                           #......RF
  ###.###        X   X       L      #.#.#.#
  #.....#        F   Q       P      #.#.#.#
  ###.###########.###.#######.#########.###
  #.....#...#.....#.......#...#.....#.#...#
  #####.#.###.#######.#######.###.###.#.#.#
  #.......#.......#.#.#.#.#...#...#...#.#.#
  #####.###.#####.#.#.#.#.###.###.#.###.###
  #.......#.....#.#...#...............#...#
  #############.#.#.###.###################
               A O F   N
               A A D   M                     """


data = """
                               L       S     F Z     O     X     Q     W
                               T       S     P Z     J     J     X     L
  #############################.#######.#####.#.#####.#####.#####.#####.#################################
  #.#.....#.....#.#.#.#.....#.....#.#.......#...#.....#.#...#.#.#.#.......#...#.#.#...#.#...#.#...#.#.#.#
  #.###.#.###.###.#.#.###.#####.###.###.#.#####.###.###.#.###.#.#.#####.###.#.#.#.#.###.#.###.#.#.#.#.#.#
  #.....#.#...#.#.....#.#...#.....#.#.#.#.#...#.#.....#.......#...#...#.....#.#.............#.#.#.....#.#
  #######.###.#.#.#####.###.#.#####.#.###.#.#.#.#####.#.#.#.#.#.#.#.###.#####.#.#.#########.#.#.#######.#
  #...#.....#.....#...#.........#.......#.#.#.....#...#.#.#.#.#.#.#...#.#.......#.........#.......#.....#
  #.#######.#####.###.#########.###.###.#.#.#######.#.###.###.###.###.#.#.#####.#.#####.#.#.#.#######.###
  #.#...#.....#.......#.#.#.#...#...#...#.#...#...#.#...#...#.#.....#...#.....#.#.....#.#.#.#.#.#.#.....#
  #.#.#####.#.###.###.#.#.#.#.#####.###.#.#.###.#####.#.#.#######.#####.#####.###########.###.#.#.#.###.#
  #...#...#.#.......#...........#.....#.#.#...#...#...#.#.....#...#.....#...#.#.....#...#.#.#.#.....#.#.#
  ###.#.#######.#############.#######.#.#.###.#.#####.#.#.#.###.#.#######.#.#.#.###.###.###.#####.###.###
  #.........#.#.#.....#...#.......#...#...#.......#...#.#.#.#.#.#.....#...#.......#.#.......#.....#...#.#
  #.###.###.#.#.#####.###.###.#####.###.#.###.#.#######.#.###.###.#.#.#.#.#.###.###.###.#####.###.#.###.#
  #.#...#.........#...............#.#...#.#...#...#.....#...#...#.#.#.#.#.#...#.#.......#.#.#...#...#...#
  ###.#######.#.#####.###.###.#####.#######.###########.#.###.###.#####.#################.#.#.#####.###.#
  #.#...#.....#.....#...#.#.....#.......#.#...#.........#.....#.#.....#...........#.#.#.#...#.#.#.#.#...#
  #.#######.###.#.###########.#########.#.###.###.###.#######.#.###.###.#.###.#####.#.#.#.#.###.#.#.#.###
  #.#...#.#.#...#...#.............#.......#.....#...#...#.......#...#...#.#...#.#...#.#...#...#.#.#...#.#
  #.###.#.#####.#####.#######.###.###.#####.###########.###.#####.#####.#######.#.###.###.#####.#.#.###.#
  #.#.........#.....#.#.....#.#.....#.....#...#.#.....#.#.......#...#.#...........#.#.#...#.#.#.#...#...#
  #.#.#####.#.#.#.###.#####.###.#####.#.#####.#.###.#.#.###.#####.#.#.#.#####.#####.#.###.#.#.#.###.#.#.#
  #.#.#.#...#.#.#.#.#.#.....#.......#.#.#.#.....#...#...#...#.....#.#.#.#.....#.#.#.#.#.....#...#...#.#.#
  #.###.###.#######.#####.#.#####.#####.#.#.#####.###.#.#.#######.###.#.#####.#.#.#.#.###.#####.###.#.###
  #.#.#...#.#.#.....#...#.#.......#.......#.....#...#.#.#.......#.....#.#...........#...#...#.#.#.......#
  #.#.#.###.#.#####.###.#######.#########.#####.#.#############.#####.#####.#########.###.###.#.###.###.#
  #.#.....#.#.#.#.#...#.#.#    U         D     P I             Q     L     M    #.#...#...#.......#.#...#
  #.#####.#.#.#.#.#.###.#.#    E         R     V Q             X     T     X    #.###.###.###.#######.#.#
  #.#.........#.#.....#.#.#                                                     #...#.#.#.#.......#.#.#.#
  #.###.#######.###.###.#.#                                                     #.###.#.#.###.#####.###.#
  #.#.#...#.....#.#.......#                                                   TI......#.........#.#.....#
  #.#.#.#######.#.###.###.#                                                     #.#.#.#.###.#.###.###.#.#
  #.....#.....#...#.#.#...#                                                     #.#.#...#...#.....#...#..IQ
  #.###.###.#####.#.#.###.#                                                     #.#.#.#.#.#####.#.#.#.###
TI..#...#.....#...#.#...#..WL                                                   #.#.#.#.#.#.....#.#.#...#
  #.#.###.#.#####.#.###.#.#                                                     #############.#####.#.###
  #.#.....#.............#.#                                                     #...#...#.#.........#.#.#
  #######.#.#.#.#.#######.#                                                     ###.###.#.#####.#.#####.#
  #.....#.#.#.#.#.#.#.....#                                                     #.............#.#.#.#....UE
  #.###.###########.###.###                                                     ###.#.#######.#####.###.#
  #...#...#.....#...#...#.#                                                     #...#.....#...........#.#
  ###.###.#.#.#####.###.#.#                                                     #.#####.#.###.###.###.#.#
OG..#...#...#...#.#.#.#.#..OB                                                   #.#.....#.#.#...#.#...#.#
  #.###.#####.###.#.#.###.#                                                     ###.###.#.#.#########.#.#
  #.......#...............#                                                   VU....#...#.#.#...#...#...#
  #.###.#.#.#.#.###.#.#####                                                     #.#########.#.#####.#####
  #...#.#.#.#.#...#.#.#....ZH                                                   #...#...#...#.....#.....#
  #####.#.###.#.#######.###                                                     #######.#.#.#.###.#.###.#
  #...#.#.#.#.#...#.......#                                                     #.....#...#.....#.....#.#
  ###.#####.###.#########.#                                                     #.#.###.#####.###.#.###.#
PV....#.#.....#.#.#.#.#...#                                                     #.#.......#.....#.#.#...#
  #.#.#.#.#.#####.#.#.#.###                                                     ###.#.#############.#.#.#
  #.#.....#.............#.#                                                   DS....#.#.#.....#.#.#.#.#..DR
  #######################.#                                                     #######.###.###.#.#######
  #.................#.....#                                                     #.#.#.................#.#
  #.###.###.#.#.#.#.#.###.#                                                     #.#.#.#####.###.#####.#.#
  #.#...#.#.#.#.#.#.#.#...#                                                   SB....#...#.....#.#...#...#
  #####.#.#########.#.#.###                                                     #.###.###.#.###.###.###.#
  #...#.......#...#...#...#                                                     #.......#.#.#...#.#.#...#
  #.#.#.###.###.#####.###.#                                                     #.#.#.#####.#####.#.#.###
GU..#...#...#...#.#.....#..SS                                                   #.#.#.#.#.#.#.#.#.#......QN
  #############.#.#######.#                                                     #####.#.#.###.#.#.#######
  #.#.#...............#.#.#                                                   OJ..#.#.#...#.......#.#....PO
  #.#.#.#######.#.###.#.###                                                     #.#.###.#.#.#####.#.###.#
AA....#.....#.#.#.#.#.....#                                                     #...#...#.....#.#...#...#
  #.###.#.#.#.#####.#####.#                                                     #.#.#.#.#.#####.#.#.#.#.#
  #...#.#.#.....#.........#                                                     #.#...#.#.#...#...#.#.#.#
  #.#.#.#####.#####.#.#####                                                     #.#.###.#.#.###.#.#.#.#.#
MX..#.....#.#...#.#.#......OQ                                                 QN..#.#...#.#.#.#.#.#...#..MH
  ###.#####.#####.###.#####                                                     ###########.#.###########
  #.#.#.#.#.....#...#.#....MH                                                 PO......#.#................YJ
  #.###.#.#.#######.#####.#                                                     #.#.###.#.#.#.###.###.#.#
  #...#.........#.........#                                                     #.#.#.....#.#.#.....#.#.#
  #.#.#.#.###############.#                                                     ###.#.#########.#.#.#.#.#
OB..#.#.#...#.#.#.#.....#.#                                                     #...#.....#.#.#.#.#.#.#.#
  #.#.#.#.###.#.#.#.#.#.#.#                                                     #.#######.#.#.###.#.#####
  #.#...#...........#.#...#                                                     #...............#.#.....#
  ###.###.#.#.#.#.#####.#.#        X D       H       O         G F         Y    #.#.#.###.###.#####.###.#
  #.....#.#.#.#.#...#...#.#        J C       Y       G         U P         J    #.#.#.#.....#.....#.#.#.#
  ###.###.###.#.#.###.#.###########.#.#######.#######.#########.#.#########.#########.###.#######.###.###
  #.#...#...#.#.#...#.#.#.#.#.....#.#...#.........#...#.........#.....#.......#.....#.#.........#.#.#...#
  #.#.###.#####.#.#.#####.#.#.###.#.###.#########.#.#####.#########.#####.#######.#####.###.#.#####.###.#
  #...#.....#.#.#.#...#.#.......#...#.......#.....#.#...........#...#.#.#.............#.#...#...........#
  ###.###.###.###.#####.#.#.###.#######.#.#####.###.#.#####.###.###.#.#.###.#.###.#.###.#.###.#.#######.#
  #.#...#...#.........#...#...#.......#.#.#...#...#.#.#...#.#.....#.#.....#.#...#.#.#...#.#...#...#.....#
  #.#.#.#.###.###.#.#######.#.#.###.#.###.#.#####.#.###.#####.#####.#.#.###.###########.#####.###.###.#.#
  #...#.#.#.....#.#...#.#...#.#.#.#.#.#.......#...#...#.......#.....#.#...#.......#.#.#.#.......#.#.#.#.#
  #.#.###.#.#.#.#####.#.#.#.#####.#.#.###.###.###.#.###.#.###.#####.#.#.###.#######.#.#.#####.###.#.###.#
  #.#...#.#.#.#.#.#.#.#.#.#...#.....#.#.....#.#.#.#...#.#...#...#.....#.#.......#.#.#...#...#.#...#.....#
  #######.#####.#.#.###.###.#####.#.#####.#####.#.#.#####.#######.#####.###.#####.#.#####.#.#####.#.###.#
  #.#.#.#.....#.#.#.......#.#.#...#.....#.#.#.....#.....#.#.#.#...#.....#.................#...#...#...#.#
  #.#.#.#.#.#####.#####.#####.#####.#####.#.###.###.#####.#.#.#######.###.#.#######.###.#.#######.#.###.#
  #.......#.#.#.#...#.......#.........#.....#.#...#.#.#.....#.#.#.#.#...#.#.....#.#...#.#.......#.#.#...#
  #.#.###.###.#.###.###.#########.###.###.###.###.#.#.#.###.#.#.#.#.###.#.###.#.#.#######.#########.###.#
  #.#.#.#...#.......................#.#...#.#.....#...#.#.......#.......#...#.#.#.#...#.#.#.....#...#...#
  #.###.#.###.###.###.#######.#########.#.#.#.###.###.###.#######.###.#####.#####.#.###.#####.#####.###.#
  #...#...#.#.#.....#.#...#...#.....#...#.#.....#.#.#.#.#.#.#.#.....#...#.....#...........#.......#.#...#
  #.###.###.#########.###.###.#.#.###.#.#####.#####.#.#.#.#.#.#######.#.#.#######.###.#####.###########.#
  #.#.....#.#.#.......#.....#...#...#.#.#.....#.........#.#.#.#...#...#.#...........#...#.#...#.....#...#
  ###.###.#.#.#######.###.#######.#####.###.#########.#.#.#.#.#.#######.###.#.###.###.###.#.###.#########
  #...#.......#.......#.#...........#.....#.#.....#...#.#...#...#...#...#...#...#.#.....................#
  #.###.#.###.#.#.#####.#####.###########.#.#.###.#.###.#.###.#.###.#.###.#.###########.###.###.#########
  #.#...#.#...#.#.#...................#...#...#...#.#...#.....#.#.....#...#...........#...#...#.........#
  #################################.###.#########.#####.#######.###.#####.###############################
                                   H   V         Z     D       S   D     O
                                   Y   U         H     C       B   S     Q
"""


m = {}
startpos = (0, 0)
endpos = (0, 0)

portals = {}
portalsR = {}
portalOutter = {}


for x, l in enumerate(data.split('\n')):
    for y, i in enumerate(l):
        m[(x, y)] = i


def handle(k, x, y):

    global startpos, endpos, portals, m, portalsR, portalOutter

    if (x, y) in m and m[(x, y)] == '.':
        if k == 'AA':
            startpos = (x, y)
        elif k == 'ZZ':
            endpos = (x, y)
        else:
            print(x, y)
            if x == 3 or x == 105 or y == 2 or y == 104:
                portalOutter[(x, y)] = True
            else:
                portalOutter[(x, y)] = False
            if k not in portals:
                portals[k] = []
            portals[k].append((x, y))
            portalsR[(x, y)] = k


for x, l in enumerate(data.split('\n')):
    for y, i in enumerate(l):

        if ord('A') <= ord(m[(x, y)]) <= ord('Z'):

            if (x + 1, y) in m and ord('A') <= ord(m[(x + 1, y)]) <= ord('Z'):

                k = m[(x, y)] + m[(x + 1, y)]

                handle(k, x + 2, y)
                handle(k, x - 1, y)

            if (x, y + 1) in m and ord('A') <= ord(m[(x, y + 1)]) <= ord('Z'):

                k = m[(x, y)] + m[(x, y + 1)]

                handle(k, x, y + 2)
                handle(k, x, y - 1)

print(startpos)
print(endpos)
print(portals)
print(portalsR)
print(portalOutter)

for x, l in enumerate(data.split('\n')):
    for y, i in enumerate(l):

        if (x, y) in portalOutter:
            print('O' if portalOutter[(x, y)] else 'I', end='')
        else:
            print(m[(x, y)], end='')

    print('')


queue = [(startpos, 0, 0)]
mdist = {}

while queue:
    tpos, tdist, level = queue.pop(0)

    if tpos == endpos and level == 0:
        print(tdist)
        import sys
        sys.exit(0)

    for test_pos in [(tpos[0] + 1, tpos[1]), (tpos[0] - 1, tpos[1]), (tpos[0], tpos[1] + 1), (tpos[0], tpos[1] - 1)]:

        bonus = 0
        bonuslevel = 0

        if test_pos in portalsR and (level > 0 or not portalOutter[test_pos]):

            bonuslevel = -1 if portalOutter[test_pos] else 1

            for x in portals[portalsR[test_pos]]:
                if x != test_pos:
                    test_pos = x
                    bonus = 1
                    break

        if test_pos not in m:
            continue

        if m[test_pos] != '.':
            continue

        if (test_pos, level) in mdist and mdist[(test_pos, level)] < tdist + 1 + bonus:
            continue

        queue.append((test_pos, tdist + 1 + bonus, level + bonuslevel))
        mdist[(test_pos, level)] = tdist + 1 + bonus
